"use strict"; var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; !function (n, t) { "object" == (typeof exports === "undefined" ? "undefined" : _typeof(exports)) && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : n.app = t(); }(undefined, function () { var g = require("./xhtad_conf.js"), h = require("./xhtad_md5.js"), lk = "https://log.xiaohutui.com", i = 0, j = {}; if (!g.app_key || 22 !== g.app_key.length) { console.warn("\u5C0F\u4E92\u63A8\u63D0\u793A\uFF1A\u914D\u7F6E\u9519\u8BEF\uFF0C\u8BF7\u5728xhtadx_conf.js\u4E2D\u6B63\u786E\u914D\u7F6E\u60A8\u7684app_key\u3002"); } var c, t = App, o = Page, m = { ak: g.app_key.replace(/(^\s*)|(\s*$)/g, ""), v: '2.14', debug: g.debug ? g.debug : false, adtype: "", reqid: "", pb: "", pm: "", sv: "", pv: "", nt: "", ww: 0, wh: 0, ad_num: 1, pr: 0, long: 0, lat: 0, wvv: "", wv: "", lang: "", wsr: {}, pp: "", uuid: "", user_info: {} }, n = 0, edata = '', p = function () { function a() { return Math.floor(65536 * (1 + Math.random())).toString(16).substring(1); } var b; try { if (b = wx.getStorageSync("xhtaduuid"), b) return b; } catch (a) { } b = a() + a() + a() + a() + a() + a() + a() + a(); try { wx.setStorageSync("xhtaduuid", b); } catch (a) { } return b; }, s = function (a) { function b() { 2 === c.length && (n = 1, a && a()); } var c = []; (function () { wx.getSetting({ success: function (a) { a.authSetting["scope.userInfo"] ? wx.getUserInfo({ withCredentials: !1, success: function (a) { m.user_info = a.userInfo; }, complete: function () { c.push("ok1"), b(); } }) : (c.push("ok1"), b()); }, fail: function () { c.push("ok1"), b(); } }); })(), function () { wx.getSystemInfo({ success: function (a) { m.wv = "undefined" == typeof a.SDKVersion ? "1.0.0" : a.SDKVersion, m.pb = a.brand, m.pm = a.model, m.pr = a.pixelRatio, m.ww = a.screenWidth, m.wh = a.screenHeight, m.lang = a.language, m.wvv = a.version, m.sv = a.system, m.pv = a.platform; }, complete: function () { c.push("ok2"), b(); } }); }(), function () { wx.getSetting({ success: function (a) { a.authSetting["scope.userLocation"] ? wx.getLocation({ type: "wgs84", success: function (a) { m.long = a.latitude, m.lat = a.longitude; }, complete: function () { c.push("ok3"), b(); } }) : (c.push("ok3"), b()); }, fail: function () { c.push("ok3"), b(); } }); }(), function () { wx.getNetworkType({ success: function (a) { m.nt = a.networkType; }, complete: function () { c.push("ok4"), b(); } }); }(); }, E = function (n, t, e) { if (n[t]) { var o = n[t]; n[t] = function (n) { o.call(this, n), e.call(this, n, t); }; } else n[t] = function (n) { e.call(this, n, t); }; }, u = function (a, b) { void v(b, ["stat/getad"], function (d) { if (0 == d.data.errcode) { if (parseFloat(m.v) < parseFloat(d.data.version)) { console.warn("发现v" + d.data.version + "版小虎推SDK，当前版本v" + m.v + "，请尽快升级！"); } var e = d.data.list, k = typeof (b) == "object" ? b[Object.keys(b)[0]] : [b]; for (var i in e) { j[k[i]] = e[i], j[k[i]].hasshow = !0, j[k[i]].id = b, j[k[i]].push = 0, j[k[i]].encdata = { 'encdata': j[k[i]].encdata }; var g = a.data.xhtad; g.adData = j, c ? a.xhtapply(j) : a.setData({ xhtad: g }); } } else; }); }, v = function (a, b, c, d) { 0 === n ? s(function () { w(a, c, b, d); }) : w(a, c, b, d); }, w = function w(a, b, c, d) { var d = d ? "get" : "post", e = lk + "/log/"; if (m.adtype = typeof (a) == "object" ? Object.keys(a)[0] : a, m.ad_num = typeof (a) == "object" ? a[Object.keys(a)[0]].length : 1, m.uuid = m.uuid || o(), "log" != c[0]) { var f = Date.now() + m.ak + m.uuid + m.adtype; m.reqid = h.hexMD5(f), m.data_type = true; } var g = 0, i = function a() { wx.request({ url: e + c[0], data: m, header: {}, method: d, success: function (a) { b(a); }, fail: function () { 2 > g && (g++ , m.retryTimes = g, setTimeout(function () { a(); }, 1e3)); } }); }; i(); }, I = function (n) { this.app = n; }, x = function (n) { this.xhtad = new I(this), I.prototype.getxhtAds = function (n, t) { var arr = []; for (var k = 0; k < n[Object.keys(n)[0]]; k++) { arr.push(k) } v({ [Object.keys(n)[0]]: arr }, ["stat/getad"], function (d) { if (!d.data.errcode) { if (parseFloat(m.v) < parseFloat(d.data.version)) { console.warn("发现v" + d.data.version + "版小虎推SDK，当前版本v" + m.v + "，请尽快升级！"); return false; } var list = []; for (var i in d.data.list) { var _adItem = d.data.list[i], adObject = {}; A(_adItem.ikey, "stat/imp", function () { }, "get"); if (_adItem.show_type != 1) { adObject = { appId: _adItem.to_appid, name: _adItem.name, desc: _adItem.desc, logo: _adItem.pic, img: _adItem.to_qr, load_page: _adItem.load_page, ckey: _adItem.ckey, adtype: _adItem.adtype, jump_type: _adItem.jump_type, encdata: _adItem.encdata } } else { adObject = { appId: _adItem.to_appid, logo: _adItem.pic, img: _adItem.to_qr, load_page: _adItem.load_page, ckey: _adItem.ckey, adtype: _adItem.adtype, jump_type: _adItem.jump_type, encdata: _adItem.encdata, } } list.push(adObject) } t({ code: 0, data: list }) } else { t({ code: 1, errmsg: d.data.errmsg }) } }); }, I.prototype.xhtAdsClk = function (k) { cli(k); }, m.uuid = p(), sa(n); }, cli = function (a) { A(a, "stat/cli", function () { }, "get"); }, sp = function (t) { var e = t.split("&"), n = {}; for (var u in e) { e[u] = e[u].split("="), n[e[u][0]] = e[u][1]; } return n; }, cka = function (s) { wx.getSetting({ success: function (res) { if (!res.authSetting['scope.userInfo']) { setTimeout(function () { wx.getSetting({ success: function (res) { if (res.authSetting['scope.userInfo']) { var _time = Date.parse(new Date()) / 1000; var dk = h.hexMD5(m.ak + m.uuid + _time); wx.getUserInfo({ success: function (info) { if (!edata) return false; wx.request({ url: lk + '/auth', method: "POST", data: { d_key: dk, time: _time, encdata: edata, uuid: m.uuid, user_info: info.userInfo }, success: function () { } }); } }); } else { cka(s); } } }); }, 6000); } } }); }, sa = function (s) { edata = s.scene == 1037 ? (s.referrerInfo.extraData || {}).encdata || s.query.encdata : sp(decodeURIComponent(s.query.scene)).encdata; wx.login({ success: function (res) { var b = { jscode: encodeURIComponent(res.code), uuid: m.uuid, appkey: m.ak, encdata: edata }, c = lk + "/log/"; wx.request({ url: c + "stat/init", method: "post", data: b }); }, fail: function () { } }), cka(s); }, A = function A(a, b) { var c = c ? "get" : "post", d = lk + "/log/", e = { key: a }; var f = 0; (function a() { wx.request({ url: d + b, data: e, method: c ? "post" : "get", success: function () { }, fail: function () { 2 > f && (f++ , e.retryTimes = f, setTimeout(function () { a(); }, 1e3)); } }); })(); }, B = function (a) { var b = a.currentTarget.dataset.id, c = j[b]; if (0 === c.push) { var d = c.ikey; if (1 === c.adtype) { var e = this, f = wx.createIntersectionObserver(e, { thresholds: [.2], selectAll: !0 }); f.relativeToViewport().observe(".xht_banner", function (a) { if (.2 < a.intersectionRatio) { var c = e.data.xhtad; c.adData[b].push = 1, e.setData({ xhtad: c }), A(d, "stat/imp", function () { }, "get"), f.disconnect(); } }); } else A(d, "stat/imp", function () { }, "get"); } }, C = function (a) { var b = a.currentTarget.dataset.id, c = this.data.xhtad; c.adData[b].hasshow = !1, this.setData({ xhtad: c }); }, D = function (a) { var b = a.currentTarget.dataset.id, d = j[b].ckey; var e = j[b].jump_type; switch (e) { case 1: { a.currentTarget.dataset.adImgUrl || (a.currentTarget.dataset.adImgUrl = j[b].to_qr), wx.previewImage({ current: a.currentTarget.dataset.adImgUrl, urls: [a.currentTarget.dataset.adImgUrl], success: function () { A(d, "stat/cli", function () { }, "get"); } }); break; } case 2: { A(d, "stat/cli", function () { }, "get"); break; } default: { console.error("SDK\u9519\u8BEF\uFF1A\u8DF3\u8F6C\u7C7B\u578B\u4E3A\uFF1A" + e + " \uFF0C\u4E0D\u662F\u7EA6\u5B9A\u7684\u7C7B\u578B\u3002\u65E0\u6CD5\u8FDB\u884C\u8DF3\u8F6C\u3001\u70B9\u51FB\u4E0A\u62A5\uFF0C\u8054\u7CFBGO\u5DE5\u7A0B\u5E08\uFF01\uFF01\uFF01"); break; } } }, y = function () { m.wsr = wx.getStorageSync("xhtwsr"), m.pp = this.route; var a; try { a = this.data.xhtad.ad; } catch (a) { } if (a) { var b = this; for (var c in a) { if (a[c]) { if (typeof (a[c]) == "object") { u(b, { [c]: a[c] }); } else { u(b, c); } } } } }, z = function () { var a = this.options.xhtadH5url; a && (a = a.replace("|", "?").replace("$", "="), this.setData({ xhtadURL: a })); }, H = { banner_style: { wrap: "position: relative; display: flex; width: 100%; overflow: hidden", img: "width: 100%; margin: 0 auto;", icon: "position: absolute; left: 2rpx; bottom: 2rpx; width: 76rpx !important; height: 24rpx !important; line-height: 24rpx; background: rgba(0, 0, 0, .2); font-size: 16rpx; color: #fff; text-align: center; border-radius: 16rpx;", nav: "position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;" }, screen_style: { wrap: "position: fixed; width: 100%; height: 100%; left: 0; top: 0; background: rgba(0, 0, 0, .3); z-index: 9999;", content: "position: relative; display: flex; width: 600rpx !important; overflow: hidden; left: calc(50% - 300rpx); top: calc(50% - 250rpx)", img: "width: 100%;", close: "position: absolute; top: 0; right: 0; width: 34rpx !important; height: 34rpx !important; padding: 10rpx; z-index: 2", nav: "position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;", icon: "position: absolute; left: 2rpx; bottom: 2rpx; width: 76rpx !important; height: 24rpx !important; line-height: 24rpx; background: rgba(0, 0, 0, .2); font-size: 16rpx; color: #fff; text-align: center; border-radius: 16rpx;" }, fixed_style: { wrap: "position: fixed; display: flex; width: 120rpx !important; right: 60rpx; bottom: 60rpx; z-index: 9998;", img: "width: 100%;border-radius:50%", nav: "position: absolute; top: 0; right: 0; left: 0; bottom: 0; margin: 0; background: none;" } };; App = function (n) { E(n, "onLaunch", x), t(n); }, Page = function (n) { E(n, "onLoad", y), E(n, "onShow", z), E(n, "xhtadClose", C), E(n, "xhtadImgLoad", B), E(n, "xhtappoIntView", D), o(n); }; });